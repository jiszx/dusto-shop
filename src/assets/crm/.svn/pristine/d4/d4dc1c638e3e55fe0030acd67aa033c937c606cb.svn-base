<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hhnz.customer.mapper.CMerchCustContractVMapper" >
  <resultMap id="BaseResultMap" type="com.hhnz.customer.model.CMerchCustContractV" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 16:46:56 CST 2016.
    -->
    <result column="ORGNAME" property="orgname" jdbcType="VARCHAR" />
    <result column="CUSTNAME" property="custname" jdbcType="VARCHAR" />
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="MERCH_CUST_ID" property="merchCustId" jdbcType="DECIMAL" />
    <result column="ORGANIZATION_ID" property="organizationId" jdbcType="VARCHAR" />
    <result column="MERCH_LEVELS" property="merchLevels" jdbcType="VARCHAR" />
    <result column="DELIVERY_ADDRESS" property="deliveryAddress" jdbcType="VARCHAR" />
    <result column="CONTRACT_BDATE" property="contractBdate" jdbcType="VARCHAR" />
    <result column="CONTRACT_EDATE" property="contractEdate" jdbcType="VARCHAR" />
    <result column="SETTLE_TYPE" property="settleType" jdbcType="VARCHAR" />
    <result column="A_PERIOD" property="aPeriod" jdbcType="VARCHAR" />
    <result column="YEAR_AMT" property="yearAmt" jdbcType="VARCHAR" />
    <result column="REBATE" property="rebate" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE1" property="attribute1" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE2" property="attribute2" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE3" property="attribute3" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE4" property="attribute4" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE5" property="attribute5" jdbcType="VARCHAR" />
    <result column="STATES" property="states" jdbcType="VARCHAR" />
    <result column="CREDIT_AMT" property="creditAmt" jdbcType="DECIMAL" />
    <result column="factory_name" property="factoryName" jdbcType="VARCHAR" />
    <result column="VIRTUAL_WAREHOUSE" property="virtualWarehouse" jdbcType="VARCHAR"/>
    <result column="cust_type" property="custType" jdbcType="VARCHAR"/>
    <result column="create_ts" property="createTs" jdbcType="TIMESTAMP"/>
    <result column="station_id" property="stationId" jdbcType="DECIMAL"/>
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 16:46:56 CST 2016.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 16:46:56 CST 2016.
    -->
    ORGNAME, CUSTNAME, ID, MERCH_CUST_ID, ORGANIZATION_ID, MERCH_LEVELS, DELIVERY_ADDRESS, 
    CONTRACT_BDATE, CONTRACT_EDATE, SETTLE_TYPE, A_PERIOD, YEAR_AMT, REBATE, ATTRIBUTE1, 
    ATTRIBUTE2, ATTRIBUTE3, ATTRIBUTE4, ATTRIBUTE5, STATES, CREDIT_AMT,factory_name,
    VIRTUAL_WAREHOUSE,cust_type,create_ts,station_id
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.hhnz.customer.model.CMerchCustContractVExample" >
    <include refid="OracleDialectPrefix" />
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 16:46:56 CST 2016.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from (SELECT (select c.name from CRM_SALES_ORGANIZATION c where c.id= cso.pid)||'-'||CSO.NAME orgname,
       CMB.NAME custname,
       CMC."ID",
       CMC."MERCH_CUST_ID",
       CMC."ORGANIZATION_ID",
       CMC."MERCH_LEVELS",
       CMC."DELIVERY_ADDRESS",
       CMC."CONTRACT_BDATE",
       CMC."CONTRACT_EDATE",
       CMC."SETTLE_TYPE",
       CMC."A_PERIOD",
       CMC."YEAR_AMT",
       CMC."REBATE",
       CMC."ATTRIBUTE1",
       CMC."ATTRIBUTE2",
       CMC."ATTRIBUTE3",
       CMC."ATTRIBUTE4",
       CMC."ATTRIBUTE5",
       CMC."STATES",
       cmc.credit_amt,
       tf.name                as factory_name,
       cmc.VIRTUAL_WAREHOUSE,
       cmb.cust_type,
       cmc.create_ts,
       cmcs.station_id
  FROM C_MERCH_CUST_CONTRACT  cmc,
       CRM_SALES_ORGANIZATION cso,
       C_MERCH_CUST_BASE      cmb,
       t_factory              tf,
       c_merch_cust_station cmcs
 WHERE CMC.ORGANIZATION_ID = CSO. ID(+)
   AND CMC.MERCH_CUST_ID = CMB. ID(+)
   and cmc.factory_id = tf.id(+)
   and cmb.id= cmcs.merch_cust_id)
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
    <include refid="OracleDialectSuffix" />
  </select>
  <select id="countByExample" parameterType="com.hhnz.customer.model.CMerchCustContractVExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 16:46:56 CST 2016.
    -->
    select count(*) from (SELECT CSO.                   NAME orgname,
       CMB.                   NAME custname,
       CMC."ID",
       CMC."MERCH_CUST_ID",
       CMC."ORGANIZATION_ID",
       CMC."MERCH_LEVELS",
       CMC."DELIVERY_ADDRESS",
       CMC."CONTRACT_BDATE",
       CMC."CONTRACT_EDATE",
       CMC."SETTLE_TYPE",
       CMC."A_PERIOD",
       CMC."YEAR_AMT",
       CMC."REBATE",
       CMC."ATTRIBUTE1",
       CMC."ATTRIBUTE2",
       CMC."ATTRIBUTE3",
       CMC."ATTRIBUTE4",
       CMC."ATTRIBUTE5",
       CMC."STATES",
       cmc.credit_amt,
       tf.name                as factory_name,
       cmc.VIRTUAL_WAREHOUSE,
       cmb.cust_type,
       cmc.create_ts,
       cmcs.station_id
  FROM C_MERCH_CUST_CONTRACT  cmc,
       CRM_SALES_ORGANIZATION cso,
       C_MERCH_CUST_BASE      cmb,
       t_factory              tf,
       c_merch_cust_station cmcs
 WHERE CMC.ORGANIZATION_ID = CSO. ID(+)
   AND CMC.MERCH_CUST_ID = CMB. ID(+)
   and cmc.factory_id = tf.id(+)
   and cmb.id= cmcs.merch_cust_id)
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <sql id="OracleDialectPrefix" >
    <if test="page != null" >
      select * from ( select row_.*, rownum rownum_ from ( 
    </if>
  </sql>
  <sql id="OracleDialectSuffix" >
    <if test="page != null" >
      <![CDATA[ ) row_ ) where rownum_ > #{page.begin} and rownum_ <= #{page.end} ]]>
    </if>
  </sql>
  
  <select id="getvirtualWarehouse" resultType="String" parameterType="java.lang.Long">
  	SELECT NVL(tar.rdc_code,'')
  		FROM t_area_rdc tar, c_merch_cust_base cmcb
 	where tar.city_id = cmcb.city_id
 	    and cmcb.id =#{merchId,jdbcType=DECIMAL}
  </select>
  
  <select id="customerDetail4Export" parameterType="java.util.Map" resultType="com.hhnz.customer.dto.CustomerBaseExport">
  	SELECT mcb.id,mcb.name,D.SHOW_TEXT AS custType,SO1.name orgname,
		CRS.NAME AS POSITION_NAME,E.NAME AS SALESMAN,
			DECODE(MCB.STATES, '1', '潜在客户','2','待审批客户','3','正式客户','4','休眠客户','5','失效客户','') AS STATES, MCB.SAP_CUSTOMER_ID sapCustomerId,MCB.CONTACT_NAME contactName,MCB.CONTACT_TEL contactTel,
		DECODE(mcb.cust_type, '70', MCB2.name,'') pname,
		cmcc.YEAR_AMT yearAmt,
		(SELECT T.NAME FROM CRM_SALES_ORGANIZATION T WHERE T.ID=SUBSTR(CRS.ORGANIZATION_ID,0,3)) AS department,
		(SELECT T.NAME FROM CRM_SALES_ORGANIZATION T, crm_sales_organization t2 WHERE 1 = 1
           		and t2.id = crs.organization_id
           		and t.id = t2.pid) AS reginName,
		(SELECT T.NAME FROM CRM_SALES_ORGANIZATION T WHERE T.ID=SUBSTR(CRS.ORGANIZATION_ID,0,9)) AS orgProv,
		(select name from t_area where id=mcb.prov_id) prov,
		(select name from t_area where id=mcb.city_id) city, 
		(select name from t_area where id=mcb.county_id) county,
		(select t.SHOW_TEXT from T_DICT t left join T_AREA_RDC ar on t.CHOOSE_VAL = ar.rdc_code and t.COL_NAME='VIRTUAL_WAREHOUSE_CODE'
		    where ar.city_id=MCB.CITY_ID and ROWNUM=1) rdc,
		MCB.ADDRESS,CRS.NAME AS positionName,CMCA.BOND_AMT bondAmt,CMCA.CREDIT_AMT creditAmt, CMCA.CASH_AMT cashAmt, CMCA.SUBSIDY_AMT subsidyAmt,
		CMCA.CONTRACT_CREDIT_AMT contractCredit,mcb.code
		
		FROM C_MERCH_CUST_BASE      mcb,
		       T_EMPLOYEE             E,
		       CRM_SALES_ORGANIZATION SO1,
		       crm_station            crs,
		       c_merch_cust_station   cmcs,
					C_MERCH_CUST_BASE mcb2,
		      (select * from C_MERCH_CUST_CONTRACT ttc where TTC.STATES='4') cmcc,
		      C_MERCH_CUST_ACCOUNT cmca,
		      (SELECT * FROM  t_dict t where
		      t.COL_NAME='CUST_MERCH_TYPE') d
		 where 1=1
		  and mcb.organization_id= SO1.id
		  and mcb.id= cmcs.merch_cust_id(+)
		  and cmcs.station_id= crs.id(+)
		  and crs.salesrep_id = e.id(+)
		  and mcb.cust_type =d.choose_val(+)
		  and mcb.pid=mcb2.id(+)
		  and mcb.id=cmcc.MERCH_CUST_ID(+)
		  and MCB.id = CMCA.MERCH_CUST_ID(+)
		  and mcb.cust_type!='5'
		  and crs.id in
		  <foreach collection="stations" item="item" open="(" close=")" separator=",">
		  	#{item}
		  </foreach>
		   order by MCB.CREATE_TS desc
  </select>
</mapper>